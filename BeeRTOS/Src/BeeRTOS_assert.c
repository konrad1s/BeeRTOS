
/******************************************************************************************
 * @brief 
 * @file 
 * ****************************************************************************************/

/******************************************************************************************
 *                                        INCLUDES                                        *
 ******************************************************************************************/

#include "BeeRTOS_assert.h"

/******************************************************************************************
 *                                         DEFINES                                        *
 ******************************************************************************************/

/******************************************************************************************
 *                                        TYPEDEFS                                        *
 ******************************************************************************************/

#if (BEERTOS_USE_ASSERT_HISTORY_LOG == true)
typedef struct
{
    uint8_t module_id;
    uint8_t error_id;
    uint32_t timestamp;
} os_error_t;
#endif

/******************************************************************************************
 *                                        VARIABLES                                       *
 ******************************************************************************************/

#if (BEERTOS_USE_ASSERT_HISTORY_LOG == true)
static os_error_t errors[BEERTOS_ASSERT_HISTORY_LOG_SIZE];
#endif

/******************************************************************************************
 *                                        FUNCTIONS                                       *
 ******************************************************************************************/
void os_report_error(uint8_t module_id, uint8_t error_id)
{
#if (BEERTOS_USE_ASSERT_HISTORY_LOG == true)
    static uint8_t index = 0U;
    errors[index].module_id = module_id;
    errors[index].error_id = error_id;
    errors[index].timestamp = os_get_tick_count();
    index = (index + 1U) % BEERTOS_ASSERT_HISTORY_LOG_SIZE;
#endif

    BEERTOS_ASSERT_ERROR_HANDLER(module_id, error_id);
}